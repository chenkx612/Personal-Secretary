# 代码架构重构计划

## 1. 项目结构优化
创建清晰的模块化目录结构：
```
src/
├── agents/          # Agent实现
├── config/          # 配置管理
├── memory/          # 记忆系统
├── prompts/         # 提示词管理
├── utils/           # 工具函数
└── main.py          # 主入口
```

## 2. 核心模块设计

### 2.1 配置管理模块 (`src/config/`)
- 统一加载和管理配置
- 支持从.env文件和环境变量加载
- 分离LLM配置、记忆配置等

### 2.2 记忆系统模块 (`src/memory/`)
- 抽象`MemoryBase`基类
- 实现`ShortTermMemory`和`LongTermMemory`子类
- 支持不同存储后端（向量数据库、文件等）

### 2.3 Agent模块 (`src/agents/`)
- 抽象`BaseAgent`基类，定义核心接口
- 实现`SimpleAgent`和`MemoryAgent`子类
- 统一的对话处理流程

### 2.4 提示词管理模块 (`src/prompts/`)
- 集中管理所有提示词模板
- 支持动态加载和更新
- 分离不同场景的提示词

## 3. 关键重构点

### 3.1 分离关注点
- 将配置初始化从Agent类中分离
- 将记忆管理逻辑独立到专门模块
- 将提示词模板管理独立

### 3.2 抽象核心接口
```python
class BaseAgent:
    def chat(self, user_input: str) -> str: ...
    def clear_memory(self) -> None: ...
    def get_profile(self) -> Dict: ...
```

### 3.3 统一配置管理
- 避免硬编码API密钥和URL
- 集中管理模型参数

### 3.4 完善错误处理
- 增强异常捕获和日志记录
- 提供清晰的错误信息

### 3.5 提高可扩展性
- 支持多种LLM模型
- 支持插件式记忆存储
- 便于添加新功能

## 4. 重构步骤

1. 创建新的目录结构
2. 实现配置管理模块
3. 实现记忆系统模块
4. 实现提示词管理模块
5. 重构BaseAgent基类
6. 重构SimpleAgent和MemoryAgent
7. 更新主入口文件
8. 测试所有功能

## 5. 预期收益

- 代码结构更清晰，易于维护
- 模块间低耦合，高内聚
- 易于扩展新功能
- 配置管理更灵活
- 错误处理更完善
- 可读性更强

通过以上重构，代码将符合工程规范，具有更好的可读性和可扩展性，便于后续功能扩展和维护。